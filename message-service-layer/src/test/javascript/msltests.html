<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>MSL Unit Tests</title>
<!-- jasmine -->
<link rel="stylesheet" type="text/css" href="../e/jasmine.css">
<script type="text/javascript" src="../e/jasmine.js"></script>
<script type="text/javascript" src="../e/jasmine-html.js"></script>

<!-- clarinet -->
<script src="../../main/javascript/lib/clarinet.js"></script>

<!-- jsrsasign -->
<script src="../../main/javascript/lib/jsrsasign/jsrsasign-4.8.3-all-min.js"></script>

<!-- libraries -->
<script src="../../main/javascript/lib/asnjwk.concat.js"></script>
<script src="../../main/javascript/lib/base64.js"></script>
<script src="../../main/javascript/lib/lzw.js"></script>
<script src="../../main/javascript/lib/promise.js"></script>
<script src="../../main/javascript/lib/textEncoding.js"></script>

<!-- source files -->
<script type="text/javascript" src="../../main/javascript/util/Arrays.js"></script>
<script type="text/javascript" src="../../main/javascript/util/Class.js"></script>
<script type="text/javascript" src="../../main/javascript/MslConstants.js"></script>
<script type="text/javascript" src="../../main/javascript/util/AsyncExecutor.js"></script>
<script type="text/javascript" src="../../main/javascript/util/BlockingQueue.js"></script>
<script type="text/javascript" src="../../main/javascript/util/ConditionVariable.js"></script>
<script type="text/javascript" src="../../main/javascript/util/Random.js"></script>
<script type="text/javascript" src="../../main/javascript/util/ReadWriteLock.js"></script>
<script type="text/javascript" src="../../main/javascript/MslError.js"></script>
<script type="text/javascript" src="../../main/javascript/MslException.js"></script>
<script type="text/javascript" src="../../main/javascript/MslCryptoException.js"></script>
<script type="text/javascript" src="../../main/javascript/MslEncodingException.js"></script>
<script type="text/javascript" src="../../main/javascript/MslEntityAuthException.js"></script>
<script type="text/javascript" src="../../main/javascript/MslErrorResponseException.js"></script>
<script type="text/javascript" src="../../main/javascript/MslInternalException.js"></script>
<script type="text/javascript" src="../../main/javascript/MslInterruptedException.js"></script>
<script type="text/javascript" src="../../main/javascript/MslIoException.js"></script>
<script type="text/javascript" src="../../main/javascript/MslKeyExchangeException.js"></script>
<script type="text/javascript" src="../../main/javascript/MslMasterTokenException.js"></script>
<script type="text/javascript" src="../../main/javascript/MslMessageException.js"></script>
<script type="text/javascript" src="../../main/javascript/MslUserAuthException.js"></script>
<script type="text/javascript" src="../../main/javascript/MslUserIdTokenException.js"></script>
<script type="text/javascript" src="../../main/javascript/crypto/WebCryptoAdapter.js"></script>
<script type="text/javascript">
	// Change crypto if an override environment is set.
	function loadPageVar(sVar) {
	    return decodeURI(window.location.search.replace(new RegExp("^(?:.*[&\\?]" + encodeURI(sVar).replace(/[\.\+\*]/g, "\\$&") + "(?:\\=([^&]*))?)?.*$", "i"), "$1"));
	}
   	var webCryptoEnv = loadPageVar('wcenv');
   	
   	if (webCryptoEnv == 'pnacl') {
   		// PNaCl
   		document.write('<scr' + 'ipt type="text/javascript" src="http://cadmium.netflix.com/cadmium/pnacl/nfcrypto_pnacl.js"></scr' + 'ipt>');
   		document.write('<scr' + 'ipt type="text/javascript" src="http://cadmium.netflix.com/cadmium/pnacl/nfcrypto_promise.js"></scr' + 'ipt>');
   		Random$setCrypto(nfCrypto);
   		MslCrypto$setWebCryptoVersion(MslCrypto$WebCryptoVersion.LEGACY);
   	} else if (webCryptoEnv == 'ppapi') {
   	    // Plugin
        document.write('<scr' + 'ipt type="text/javascript" src="http://cadmium.netflix.com/cadmium/dev/Plugin/NfWebCrypto/linux/release/Latest/nfcrypto.js"></scr' + 'ipt>');
   	    Random$setCrypto(nfCrypto);
   	    MslCrypto$setWebCryptoVersion(MslCrypto$WebCryptoVersion.V2014_01);
   	}
</script>
<script type="text/javascript" src="../../main/javascript/crypto/WebCryptoAlgorithm.js"></script>
<script type="text/javascript" src="../../main/javascript/crypto/WebCryptoUsage.js"></script>
<script type="text/javascript" src="../../main/javascript/crypto/CipherKey.js"></script>
<script type="text/javascript" src="../../main/javascript/crypto/PublicKey.js"></script>
<script type="text/javascript" src="../../main/javascript/crypto/PrivateKey.js"></script>
<script type="text/javascript" src="../../main/javascript/crypto/MslCiphertextEnvelope.js"></script>
<script type="text/javascript" src="../../main/javascript/crypto/MslSignatureEnvelope.js"></script>
<script type="text/javascript" src="../../main/javascript/crypto/ICryptoContext.js"></script>
<script type="text/javascript" src="../../main/javascript/crypto/JsonWebEncryptionCryptoContext.js"></script>
<script type="text/javascript" src="../../main/javascript/crypto/NullCryptoContext.js"></script>
<script type="text/javascript" src="../../main/javascript/crypto/RsaCryptoContext.js"></script>
<script type="text/javascript" src="../../main/javascript/crypto/SymmetricCryptoContext.js"></script>
<script type="text/javascript" src="../../main/javascript/crypto/SessionCryptoContext.js"></script>
<script type="text/javascript" src="../../main/javascript/entityauth/EntityAuthenticationScheme.js"></script>
<script type="text/javascript" src="../../main/javascript/entityauth/EntityAuthenticationData.js"></script>
<script type="text/javascript" src="../../main/javascript/entityauth/PresharedKeyStore.js"></script>
<script type="text/javascript" src="../../main/javascript/entityauth/PresharedAuthenticationData.js"></script>
<script type="text/javascript" src="../../main/javascript/entityauth/PresharedProfileAuthenticationData.js"></script>
<script type="text/javascript" src="../../main/javascript/entityauth/RsaAuthenticationData.js"></script>
<script type="text/javascript" src="../../main/javascript/entityauth/X509AuthenticationData.js"></script>
<script type="text/javascript" src="../../main/javascript/entityauth/UnauthenticatedAuthenticationData.js"></script>
<script type="text/javascript" src="../../main/javascript/entityauth/UnauthenticatedSuffixedAuthenticationData.js"></script>
<script type="text/javascript" src="../../main/javascript/entityauth/EntityAuthenticationFactory.js"></script>
<script type="text/javascript" src="../../main/javascript/entityauth/PresharedAuthenticationFactory.js"></script>
<script type="text/javascript" src="../../main/javascript/entityauth/PresharedProfileAuthenticationFactory.js"></script>
<script type="text/javascript" src="../../main/javascript/entityauth/RsaStore.js"></script>
<script type="text/javascript" src="../../main/javascript/entityauth/RsaAuthenticationFactory.js"></script>
<script type="text/javascript" src="../../main/javascript/entityauth/X509Store.js"></script>
<script type="text/javascript" src="../../main/javascript/entityauth/X509AuthenticationFactory.js"></script>
<script type="text/javascript" src="../../main/javascript/entityauth/UnauthenticatedAuthenticationFactory.js"></script>
<script type="text/javascript" src="../../main/javascript/entityauth/UnauthenticatedSuffixedAuthenticationFactory.js"></script>
<script type="text/javascript" src="../../main/javascript/io/InputStream.js"></script>
<script type="text/javascript" src="../../main/javascript/io/OutputStream.js"></script>
<script type="text/javascript" src="../../main/javascript/io/ByteArrayInputStream.js"></script>
<script type="text/javascript" src="../../main/javascript/io/ByteArrayOutputStream.js"></script>
<script type="text/javascript" src="../../main/javascript/io/Url.js"></script>
<script type="text/javascript" src="../../main/javascript/io/inputStreamToJSON.js"></script>
<script type="text/javascript" src="../../main/javascript/keyx/KeyExchangeScheme.js"></script>
<script type="text/javascript" src="../../main/javascript/keyx/KeyRequestData.js"></script>
<script type="text/javascript" src="../../main/javascript/keyx/KeyResponseData.js"></script>
<script type="text/javascript" src="../../main/javascript/keyx/KeyExchangeFactory.js"></script>
<script type="text/javascript" src="../../main/javascript/keyx/WrapCryptoContextRepository.js"></script>
<script type="text/javascript" src="../../main/javascript/keyx/AsymmetricWrappedExchange.js"></script>
<script type="text/javascript" src="../../main/javascript/keyx/DiffieHellmanParameters.js"></script>
<script type="text/javascript" src="../../main/javascript/keyx/DiffieHellmanExchange.js"></script>
<script type="text/javascript" src="../../main/javascript/keyx/JsonWebEncryptionLadderExchange.js"></script>
<script type="text/javascript" src="../../main/javascript/keyx/JsonWebKeyLadderExchange.js"></script>
<script type="text/javascript" src="../../main/javascript/keyx/SymmetricWrappedExchange.js"></script>
<script type="text/javascript" src="../../main/javascript/msg/ClarinetParser.js"></script>
<script type="text/javascript" src="../../main/javascript/msg/Header.js"></script>
<script type="text/javascript" src="../../main/javascript/msg/ErrorHeader.js"></script>
<script type="text/javascript" src="../../main/javascript/msg/MessageCapabilities.js"></script>
<script type="text/javascript" src="../../main/javascript/msg/MessageHeader.js"></script>
<script type="text/javascript" src="../../main/javascript/msg/PayloadChunk.js"></script>
<script type="text/javascript" src="../../main/javascript/msg/MessageBuilder.js"></script>
<script type="text/javascript" src="../../main/javascript/msg/MessageDebugContext.js"></script>
<script type="text/javascript" src="../../main/javascript/msg/MessageServiceTokenBuilder.js"></script>
<script type="text/javascript" src="../../main/javascript/msg/MessageInputStream.js"></script>
<script type="text/javascript" src="../../main/javascript/msg/MessageOutputStream.js"></script>
<script type="text/javascript" src="../../main/javascript/msg/MessageContext.js"></script>
<script type="text/javascript" src="../../main/javascript/msg/NonReplayableMessageContext.js"></script>
<script type="text/javascript" src="../../main/javascript/msg/PublicMessageContext.js"></script>
<script type="text/javascript" src="../../main/javascript/msg/SecretMessageContext.js"></script>
<script type="text/javascript" src="../../main/javascript/msg/ErrorMessageRegistry.js"></script>
<script type="text/javascript" src="../../main/javascript/msg/FilterStreamFactory.js"></script>
<script type="text/javascript" src="../../main/javascript/msg/MslControl.js"></script>
<script type="text/javascript" src="../../main/javascript/tokens/MslUser.js"></script>
<script type="text/javascript" src="../../main/javascript/tokens/TokenFactory.js"></script>
<script type="text/javascript" src="../../main/javascript/tokens/MasterToken.js"></script>
<script type="text/javascript" src="../../main/javascript/tokens/UserIdToken.js"></script>
<script type="text/javascript" src="../../main/javascript/tokens/ServiceToken.js"></script>
<script type="text/javascript" src="../../main/javascript/tokens/ClientTokenFactory.js"></script>
<script type="text/javascript" src="../../main/javascript/userauth/UserAuthenticationScheme.js"></script>
<script type="text/javascript" src="../../main/javascript/userauth/UserAuthenticationData.js"></script>
<script type="text/javascript" src="../../main/javascript/userauth/UserAuthenticationFactory.js"></script>
<script type="text/javascript" src="../../main/javascript/userauth/EmailPasswordStore.js"></script>
<script type="text/javascript" src="../../main/javascript/userauth/EmailPasswordAuthenticationData.js"></script>
<script type="text/javascript" src="../../main/javascript/userauth/EmailPasswordAuthenticationFactory.js"></script>
<script type="text/javascript" src="../../main/javascript/userauth/UserIdTokenAuthenticationData.js"></script>
<script type="text/javascript" src="../../main/javascript/userauth/UserIdTokenAuthenticationFactory.js"></script>
<script type="text/javascript" src="../../main/javascript/util/AuthenticationUtils.js"></script>
<script type="text/javascript" src="../../main/javascript/util/MslContext.js"></script>
<script type="text/javascript" src="../../main/javascript/util/MslStore.js"></script>
<script type="text/javascript" src="../../main/javascript/util/MslUtils.js"></script>
<script type="text/javascript" src="../../main/javascript/util/NullMslStore.js"></script>
<script type="text/javascript" src="../../main/javascript/util/SimpleMslStore.js"></script>

<!-- test classes -->
<script type="text/javascript" src="../stUtils.js"></script>
<script type="text/javascript" src="../kTokenFactory.js"></script>
<script type="text/javascript" src="../slContext.js"></script>
<script type="text/javascript" src="..//MockPresharedKeyStore.js"></script>
<script type="text/javascript" src="..//MockPresharedAuthenticationFactory.js"></script>
<script type="text/javascript" src="..//MockPresharedProfileAuthenticationFactory.js"></script>
<script type="text/javascript" src="..//MockRsaAuthenticationFactory.js"></script>
<script type="text/javascript" src="..//MockUnauthenticatedAuthenticationFactory.js"></script>
<script type="text/javascript" src="..//MockX509AuthenticationFactory.js"></script>
<script type="text/javascript" src="../kMslUser.js"></script>
<script type="text/javascript" src="../ryptoContextRepository.js"></script>
<script type="text/javascript" src="../iffieHellmanParameters.js"></script>
<script type="text/javascript" src="../eFilterStreamFactory.js"></script>
<script type="text/javascript" src="../ssageContext.js"></script>
<script type="text/javascript" src="../ockEmailPasswordStore.js"></script>
<script type="text/javascript" src="../ockEmailPasswordAuthenticationFactory.js"></script>
<script type="text/javascript" src="../ockUserIdTokenAuthenticationFactory.js"></script>
<script type="text/javascript" src="../uthenticationUtils.js"></script>

<!-- test specifications -->
<script type="text/javascript" src="../test.js"></script>
<script type="text/javascript" src="../t.js"></script>
<script type="text/javascript" src="../codingtest.js"></script>
<script type="text/javascript" src="../sTest.js"></script>
<script type="text/javascript" src="../Test.js"></script>
<script type="text/javascript" src="../mTest.js"></script>
<script type="text/javascript" src="../tsTest.js"></script>
<script type="text/javascript" src="../st.js"></script>
<script type="text/javascript" src="../onTest.js"></script>
<script type="text/javascript" src="../xceptionTest.js"></script>
<script type="text/javascript" src="../herKeyTest.js"></script>
<script type="text/javascript" src="../nWebEncryptionCryptoContextSuite.js"></script>
<script type="text/javascript" src="../CiphertextEnvelopeTest.js"></script>
<script type="text/javascript" src="../SignatureEnvelopeTest.js"></script>
<script type="text/javascript" src="../lCryptoContextTest.js"></script>
<script type="text/javascript" src="../CryptoContextSuite.js"></script>
<script type="text/javascript" src="../metricCryptoContextTest.js"></script>
<script type="text/javascript" src="../sionCryptoContextTest.js"></script>
<script type="text/javascript" src="..//EntityAuthenticationDataTest.js"></script>
<script type="text/javascript" src="..//EntityAuthenticationSchemeTest.js"></script>
<script type="text/javascript" src="..//PresharedAuthenticationDataTest.js"></script>
<script type="text/javascript" src="..//PresharedProfileAuthenticationDataTest.js"></script>
<script type="text/javascript" src="..//RsaAuthenticationDataTest.js"></script>
<script type="text/javascript" src="..//X509AuthenticationDataTest.js"></script>
<script type="text/javascript" src="..//UnauthenticatedAuthenticationDataTest.js"></script>
<script type="text/javascript" src="..//UnauthenticatedSuffixedAuthenticationDataTest.js"></script>
<script type="text/javascript" src="..//PresharedAuthenticationFactoryTest.js"></script>
<script type="text/javascript" src="..//PresharedProfileAuthenticationFactoryTest.js"></script>
<script type="text/javascript" src="..//RsaAuthenticationFactoryTest.js"></script>
<script type="text/javascript" src="..//X509AuthenticationFactoryTest.js"></script>
<script type="text/javascript" src="..//UnauthenticatedAuthenticationFactoryTest.js"></script>
<script type="text/javascript" src="..//UnauthenticatedSuffixedAuthenticationFactoryTest.js"></script>
<script type="text/javascript" src="../etricWrappedExchangeSuite.js"></script>
<script type="text/javascript" src="../eHellmanExchangeSuite.js"></script>
<script type="text/javascript" src="../ebEncryptionLadderExchangeSuite.js"></script>
<script type="text/javascript" src="../ebKeyLadderExchangeSuite.js"></script>
<script type="text/javascript" src="../tricWrappedExchangeSuite.js"></script>
<script type="text/javascript" src="../eaderTest.js"></script>
<script type="text/javascript" src="../eCapabilitiesTest.js"></script>
<script type="text/javascript" src="../eHeaderTest.js"></script>
<script type="text/javascript" src="../dChunkTest.js"></script>
<script type="text/javascript" src="../eBuilderSuite.js"></script>
<script type="text/javascript" src="../eServiceTokenBuilderTest.js"></script>
<script type="text/javascript" src="../eInputStreamTest.js"></script>
<script type="text/javascript" src="../eOutputStreamTest.js"></script>
<script type="text/javascript" src="../terTokenTest.js"></script>
<script type="text/javascript" src="../rIdTokenTest.js"></script>
<script type="text/javascript" src="../viceTokenTest.js"></script>
<script type="text/javascript" src="../serAuthenticationDataTest.js"></script>
<script type="text/javascript" src="../mailPasswordAuthenticationDataTest.js"></script>
<script type="text/javascript" src="../mailPasswordAuthenticationFactoryTest.js"></script>
<script type="text/javascript" src="../serIdTokenAuthenticationDataTest.js"></script>
<script type="text/javascript" src="../serIdTokenAuthenticationFactoryTest.js"></script>
<script type="text/javascript" src="../ingQueueTest.js"></script>
<script type="text/javascript" src="../tionVariableTest.js"></script>
<script type="text/javascript" src="../riteLockTest.js"></script>
<script type="text/javascript" src="../eMslStoreTest.js"></script>
<script type="text/javascript" src="../slStoreTest.js"></script>
</head>
<body>

<strong>Web Crypto Execution Environment:</strong>
<ul>
<li><a href="?wcenv=pnacl">PNaCl</a></li>
<li><a href="?wcenv=ppapi">PPAPI</a></li>
<li><a href="#">Native</a>
</ul>

<p><em>Some tests may fail in your browser or JavaScript environment if certain Web Crypto API algorithms, key sizes, or operations are not supported.</em></p>

<script type="text/javascript">
(function() {
    var jasmineEnv = jasmine.getEnv();
    jasmineEnv.updateInterval = 250;

    var htmlReporter = new jasmine.HtmlReporter();
    jasmineEnv.addReporter(htmlReporter);

    jasmineEnv.specFilter = function(spec) {
        return htmlReporter.specFilter(spec);
    };

    var currentWindowOnload = window.onload;
	window.onload = function() {
	    if (currentWindowOnload)
	        currentWindowOnload();
	    
	    // PNaCl
    	if (webCryptoEnv == 'pnacl') {
		    var plugin = window.document.getElementById("NfWebCrypto");
		    plugin.addEventListener('message', execJasmine, true);
		    
		    function execJasmine(message) {
		        plugin.removeEventListener('message', execJasmine);
		        var data = JSON.parse(message.data);
		        if (data.success && data.method == 'ready')
		            jasmineEnv.execute();
		    }
		} else {
        	jasmineEnv.execute();
	    }
    };
})();
</script>
</body>
</html>
